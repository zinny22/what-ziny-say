# 자바스크립트의 이벤트 루프

자바스크립트 엔진은 단 하나의 실행 컨텍스트 스택을 갖습니다.<br/>
이는 함수의 실행 창구가 단 하나로, 동시에 2개 이상의 함수를 실행할 수 없다는 것을 의미합니다.<br/>
즉 자바스크립트는 한 번에 하나의 작업만 실행할 수 있는 싱글 스레드 방식으로 동작합니다.<br/>

싱글 스레드 방식은 처리에 시간이 걸리는 작업을 실행하는 경우 작업이 중단되는 문제가 발생합니다.<br/>
현재 실행중인 작업이 종료될 때까지 다음 작업이 대기하는 방식을 동기처리라고 합니다.<br/>

하지만 모든 작업을 동기로 처리하게 되면,<br/>
타이머가 흘러가는 동안 브라우저는 아무작업도 하지 못한채 대기하는 문제가 발생하게 됩니다.<br/>
그래서 현재 실행 중인 작업이 종료되지 않았더라도, 다음 작업을 실행하는 비동기 작업이 중요합니다.<br/>

## 기본 정리 
<img width="735" alt="Screenshot 2025-05-30 at 9 09 05 PM" src="https://github.com/user-attachments/assets/5bb63d92-8d25-4afa-88a6-15876f55223f" />

- `Call Stack`: 자바스크립트 엔진이 코드 실행을 위해 사용하는 메모리 구조
- `Heap`: 객체가 저장되는 메모리 공간
- `Web APIs`: 브라우저에서 제공하는 API 모음, 콜 스택에서 실행된 비동기 함수는 Web APIs를 호출합니다.
- `Callback Queue`: 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역입니다.
<br/>

콜 스택과 힙으로 구성되어있는 자바스크립트 엔진은<br/>
단순하게 작업이 요청되면 콜 스택을 통해서 요청된 작업을 순차적으로 실행할 뿐입니다.<br/>
이런 비동기 작업들은 자바스크립트의 엔진이 아닌 브라우저 내부에서 처리됩니다.


> 즉, `setTimeout`, `DOM 이벤트`, `fetch()` 같은 비동기 작업은 자바스크립트가 직접 처리하는 것이 아니라, 브라우저(Web API 영역)가 처리한 후, 결과를 자바스크립트에 다시 넘겨주는 구조입니다.

## 이벤트 루프 (Event Loop)
화면에서 애니메이션 효과를 통해 움직이면서 이벤트를 처리하기도 하고,<br/>
HTTP요청을 통해 데이터를 가지고 오면서 화면을 렌더링 하기도 하는 자바스크립트의 동시성을 지원하는 것입니다.

쉽게 말하면 싱글 스레드인 자바스크립트에서 비동기 작업을 마치 멀티 스레드 처럼 처리 가능하게 해주는 구조가 이벤트 루프입니다.<br/>
이벤트 루프는 브라우저 내부의 call stack, Callback Queue, Web APIs등의 요소들을 모니터링하면서,<br/>
비동기적으로 실행되는 작업을 관리하고, 순서대로 처리해 프로그램의 실행 흐름을 제어하는 것입니다..<br/>
> 브라우저의 동작 타이밍을 제어하는 관리자 라고 할 수 있습니다.

<img width="774" alt="Screenshot 2025-05-30 at 9 00 32 PM" src="https://github.com/user-attachments/assets/d727d527-349d-494d-99d6-f814744ea417" />

- 자바스크립트의 `Call Stack`에서 실행된 비동기 함수는 `Web APIs`를 호출합니다.
- `Web APIs`에서 실행된 콜백함수를 Callback Queue에 집어 넣는다.
- 이벤트 루프는 `Call Stack`에 현재 실행 중인 작업이 있는지, `Callback Queue`에 대기 중인 함수가 있는지 반복해서 확인 합니다.
- 만약 `Call Stack`이 비어있고, `Callback Queue`에 대기 중인 함수가 있다면 대기 중인 함수를 `Call Stack`으로 이동시킵니다.


## 🗣️ What-ziny-say
자바스크립트는 싱글 스레드 언어라서 한번에 하나의 작업만 처리할 수 있습니다. <br/>
그래서 오래 걸리는 작업이 있으면 다음 작업이 중단되는 문제가 생기게 됩니다.<br/>
이런 문제를 해결하기 위해서 브라우저가 Web API, 콜백 큐, 이벤트 루프 같은 구조를 제공해 줍니다.

예를 들면, 비동기 함수가 실행되면 Web API를 호출합니다.<br/>
Web API에서 실행된 콜백 함수는 Callback Queue에 담습니다. <br/>
이벤트 루프는 Call Stack과 Callback Queue를 반복해서 확인하면서 각각의 상태를 확인합니다. <br/>
만약 Call Stack이 비어있고, Callback Queue에 대기중인 작업이 있다면 대기 중인 함수를 Call Stack으로 이동시켜줍니다.<br/>

이런 방식을 통해서 싱글 스레드인 자바스크립트가 멀티 스레드 인 것 처럼 보여지게 됩니다.



